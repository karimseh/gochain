#!/bin/sh
set -e  # Exit immediately on error
. "$(dirname "$0")/_/husky.sh"

echo "ðŸ”„ Formatting Go files..."
go fmt ./...
gofmt -w $(find . -name '*.go' -not -path './vendor/*' 2>/dev/null || true)

echo "ðŸ“¦ Staging formatted files..."
git add -u

echo "ðŸ§¹ Linting..."
golangci-lint run ./...

echo "ðŸ§ª Testing with race detector..."
gotestsum --format dots-v2 -- -cover -race -v ./...

echo "ðŸ”’ Verifying modules..."
go mod verify

echo "âœ… All pre-commit checks passed!"